<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçï Sistema de Gesti√≥n - Pizzer√≠a</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Plus Jakarta Sans', sans-serif; }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, createContext, useContext } = React;

    // ============================================
    // üçï SISTEMA DE GESTI√ìN DE PIZZER√çA
    // ============================================

    // Contexto de autenticaci√≥n
    const AuthContext = createContext(null);

    // Usuarios predefinidos
    const USERS = {
      admin: { username: 'admin', password: 'admin123', role: 'admin', name: 'Administrador' },
      cajero: { username: 'cajero', password: 'cajero123', role: 'cajero', name: 'Cajero Principal' }
    };

    // Productos iniciales
    const INITIAL_PRODUCTS = [
      { id: 1, name: 'Pizza de Pepperoni', price: 99, category: 'pizza', image: 'üçï', active: true },
      { id: 2, name: 'Pizza de Jam√≥n', price: 99, category: 'pizza', image: 'üçï', active: true },
      { id: 3, name: 'Pizza Hawaiana', price: 99, category: 'pizza', image: 'üçç', active: true },
      { id: 4, name: 'Pizza de Queso', price: 99, category: 'pizza', image: 'üßÄ', active: true },
    ];

    // Utilidades de almacenamiento
    const Storage = {
      get: (key, defaultValue) => {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : defaultValue;
        } catch {
          return defaultValue;
        }
      },
      set: (key, value) => {
        localStorage.setItem(key, JSON.stringify(value));
      }
    };

    // Formatear moneda
    const formatCurrency = (amount) => `$${amount.toFixed(2)} MXN`;

    // Formatear fecha
    const formatDate = (date) => new Date(date).toLocaleDateString('es-MX', {
      year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
    });

    // ============================================
    // COMPONENTE PRINCIPAL
    // ============================================
    function PizzeriaApp() {
      const [user, setUser] = useState(null);
      const [products, setProducts] = useState(() => Storage.get('products', INITIAL_PRODUCTS));
      const [sales, setSales] = useState(() => Storage.get('sales', []));
      const [cart, setCart] = useState([]);
      const [view, setView] = useState('pos');
      const [notification, setNotification] = useState(null);

      // Guardar datos cuando cambien
      useEffect(() => {
        Storage.set('products', products);
      }, [products]);

      useEffect(() => {
        Storage.set('sales', sales);
      }, [sales]);

      // Mostrar notificaci√≥n
      const showNotification = (message, type = 'success') => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 3000);
      };

      // Login
      const login = (username, password) => {
        const foundUser = Object.values(USERS).find(
          u => u.username === username && u.password === password
        );
        if (foundUser) {
          setUser(foundUser);
          showNotification(`¬°Bienvenido, ${foundUser.name}!`);
          return true;
        }
        return false;
      };

      // Logout
      const logout = () => {
        setUser(null);
        setCart([]);
        setView('pos');
      };

      // Agregar al carrito
      const addToCart = (product) => {
        const existing = cart.find(item => item.id === product.id);
        if (existing) {
          setCart(cart.map(item =>
            item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
          ));
        } else {
          setCart([...cart, { ...product, quantity: 1 }]);
        }
        showNotification(`${product.name} agregado`);
      };

      // Remover del carrito
      const removeFromCart = (productId) => {
        setCart(cart.filter(item => item.id !== productId));
      };

      // Actualizar cantidad
      const updateQuantity = (productId, quantity) => {
        if (quantity <= 0) {
          removeFromCart(productId);
        } else {
          setCart(cart.map(item =>
            item.id === productId ? { ...item, quantity } : item
          ));
        }
      };

      // Procesar venta
      const processSale = (paymentMethod) => {
        if (cart.length === 0) return;

        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const sale = {
          id: Date.now(),
          items: [...cart],
          total,
          paymentMethod,
          date: new Date().toISOString(),
          cashier: user.name
        };

        setSales([...sales, sale]);
        setCart([]);
        showNotification('¬°Venta procesada exitosamente!');
        
        // Imprimir recibo autom√°ticamente
        printReceipt(sale);
      };

      // Imprimir recibo
      const printReceipt = (sale) => {
        const receiptWindow = window.open('', '_blank', 'width=300,height=600');
        receiptWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>Recibo #${sale.id}</title>
            <style>
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body { 
                font-family: 'Courier New', monospace; 
                padding: 20px; 
                max-width: 280px; 
                margin: 0 auto;
                font-size: 12px;
              }
              .header { text-align: center; margin-bottom: 20px; border-bottom: 2px dashed #000; padding-bottom: 15px; }
              .header h1 { font-size: 24px; margin-bottom: 5px; }
              .header p { font-size: 10px; color: #666; }
              .info { margin: 15px 0; font-size: 11px; }
              .items { border-top: 1px dashed #000; border-bottom: 1px dashed #000; padding: 15px 0; margin: 15px 0; }
              .item { display: flex; justify-content: space-between; margin: 8px 0; }
              .item-name { flex: 1; }
              .item-qty { width: 30px; text-align: center; }
              .item-price { width: 70px; text-align: right; }
              .total { font-size: 18px; font-weight: bold; text-align: right; margin: 15px 0; padding-top: 10px; border-top: 2px solid #000; }
              .footer { text-align: center; margin-top: 20px; font-size: 10px; color: #666; }
              .footer p { margin: 5px 0; }
              @media print {
                body { padding: 0; }
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>üçï PIZZER√çA</h1>
              <p>Sistema de Gesti√≥n</p>
              <p>RFC: XXXX000000XXX</p>
            </div>
            <div class="info">
              <p><strong>Recibo:</strong> #${sale.id}</p>
              <p><strong>Fecha:</strong> ${formatDate(sale.date)}</p>
              <p><strong>Cajero:</strong> ${sale.cashier}</p>
              <p><strong>M√©todo de pago:</strong> ${sale.paymentMethod}</p>
            </div>
            <div class="items">
              <div class="item" style="font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 5px;">
                <span class="item-name">Producto</span>
                <span class="item-qty">Cant</span>
                <span class="item-price">Precio</span>
              </div>
              ${sale.items.map(item => `
                <div class="item">
                  <span class="item-name">${item.name}</span>
                  <span class="item-qty">${item.quantity}</span>
                  <span class="item-price">$${(item.price * item.quantity).toFixed(2)}</span>
                </div>
              `).join('')}
            </div>
            <div class="total">
              TOTAL: ${formatCurrency(sale.total)}
            </div>
            <div class="footer">
              <p>¬°Gracias por su compra!</p>
              <p>Vuelva pronto üçï</p>
              <p style="margin-top: 15px;">--- FIN DEL RECIBO ---</p>
            </div>
            <script>
              window.onload = function() {
                window.print();
              }
            </script>
          </body>
          </html>
        `);
        receiptWindow.document.close();
      };

      // Agregar producto
      const addProduct = (product) => {
        const newProduct = {
          ...product,
          id: Date.now(),
          active: true
        };
        setProducts([...products, newProduct]);
        showNotification('Producto creado exitosamente');
      };

      // Actualizar producto
      const updateProduct = (id, updates) => {
        setProducts(products.map(p => p.id === id ? { ...p, ...updates } : p));
        showNotification('Producto actualizado');
      };

      // Eliminar producto
      const deleteProduct = (id) => {
        setProducts(products.filter(p => p.id !== id));
        showNotification('Producto eliminado');
      };

      // Calcular estad√≠sticas de ventas
      const getSalesStats = () => {
        const now = new Date();
        const today = now.toDateString();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        const todaySales = sales.filter(s => new Date(s.date).toDateString() === today);
        const monthSales = sales.filter(s => {
          const d = new Date(s.date);
          return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
        });

        return {
          today: {
            count: todaySales.length,
            total: todaySales.reduce((sum, s) => sum + s.total, 0)
          },
          month: {
            count: monthSales.length,
            total: monthSales.reduce((sum, s) => sum + s.total, 0)
          },
          historical: {
            count: sales.length,
            total: sales.reduce((sum, s) => sum + s.total, 0)
          }
        };
      };

      const contextValue = {
        user, login, logout,
        products, addProduct, updateProduct, deleteProduct,
        sales, getSalesStats, printReceipt,
        cart, addToCart, removeFromCart, updateQuantity, processSale,
        view, setView, showNotification
      };

      return (
        <AuthContext.Provider value={contextValue}>
          <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-red-50">
            {/* Notificaci√≥n */}
            {notification && (
              <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-2xl shadow-2xl transform transition-all duration-300 ${
                notification.type === 'success' 
                  ? 'bg-gradient-to-r from-emerald-500 to-green-600 text-white' 
                  : 'bg-gradient-to-r from-red-500 to-rose-600 text-white'
              }`}>
                <div className="flex items-center gap-2">
                  <span className="text-xl">{notification.type === 'success' ? '‚úì' : '‚úï'}</span>
                  <span className="font-medium">{notification.message}</span>
                </div>
              </div>
            )}

            {!user ? <LoginScreen /> : <Dashboard />}
          </div>
        </AuthContext.Provider>
      );
    }

    // ============================================
    // PANTALLA DE LOGIN
    // ============================================
    function LoginScreen() {
      const { login, showNotification } = useContext(AuthContext);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [isLoading, setIsLoading] = useState(false);

      const handleSubmit = (e) => {
        e.preventDefault();
        setIsLoading(true);
        
        setTimeout(() => {
          if (!login(username, password)) {
            showNotification('Credenciales incorrectas', 'error');
          }
          setIsLoading(false);
        }, 500);
      };

      return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="w-full max-w-md">
            {/* Logo y t√≠tulo */}
            <div className="text-center mb-8">
              <div className="inline-block p-6 bg-gradient-to-br from-orange-500 to-red-600 rounded-3xl shadow-2xl mb-6 transform hover:scale-105 transition-transform">
                <span className="text-7xl">üçï</span>
              </div>
              <h1 className="text-4xl font-extrabold text-gray-800 tracking-tight">
                PIZZER√çA
              </h1>
              <p className="text-gray-500 mt-2 text-lg">Sistema de Gesti√≥n</p>
            </div>

            {/* Formulario */}
            <form onSubmit={handleSubmit} className="bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl p-8 border border-white/50">
              <div className="space-y-6">
                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">
                    Usuario
                  </label>
                  <input
                    type="text"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:border-orange-500 focus:bg-white focus:outline-none transition-all text-lg"
                    placeholder="Ingresa tu usuario"
                    required
                  />
                </div>

                <div>
                  <label className="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">
                    Contrase√±a
                  </label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:border-orange-500 focus:bg-white focus:outline-none transition-all text-lg"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    required
                  />
                </div>

                <button
                  type="submit"
                  disabled={isLoading}
                  className="w-full py-4 bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold text-lg rounded-2xl hover:from-orange-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-orange-300 transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed shadow-xl"
                >
                  {isLoading ? (
                    <span className="flex items-center justify-center gap-2">
                      <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"/>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                      </svg>
                      Ingresando...
                    </span>
                  ) : 'Iniciar Sesi√≥n'}
                </button>
              </div>
            </form>

            {/* Credenciales de prueba */}
            <div className="mt-8 bg-white/60 backdrop-blur rounded-2xl p-6 border border-white/50">
              <h3 className="font-bold text-gray-700 mb-4 text-center">üîê Credenciales de Prueba</h3>
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl border border-purple-200">
                  <p className="font-bold text-purple-700 mb-1">üëë Admin</p>
                  <p className="text-gray-600">Usuario: <code className="bg-white px-2 py-0.5 rounded">admin</code></p>
                  <p className="text-gray-600">Pass: <code className="bg-white px-2 py-0.5 rounded">admin123</code></p>
                </div>
                <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl border border-blue-200">
                  <p className="font-bold text-blue-700 mb-1">üíº Cajero</p>
                  <p className="text-gray-600">Usuario: <code className="bg-white px-2 py-0.5 rounded">cajero</code></p>
                  <p className="text-gray-600">Pass: <code className="bg-white px-2 py-0.5 rounded">cajero123</code></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // DASHBOARD PRINCIPAL
    // ============================================
    function Dashboard() {
      const { user, logout, view, setView } = useContext(AuthContext);

      const menuItems = [
        { id: 'pos', label: 'Punto de Venta', icon: 'üõí', roles: ['admin', 'cajero'] },
        { id: 'sales', label: 'Reportes', icon: 'üìä', roles: ['admin'] },
        { id: 'products', label: 'Productos', icon: 'üì¶', roles: ['admin'] },
        { id: 'history', label: 'Historial', icon: 'üìã', roles: ['admin', 'cajero'] },
      ];

      const filteredMenu = menuItems.filter(item => item.roles.includes(user.role));

      return (
        <div className="min-h-screen flex">
          {/* Sidebar */}
          <aside className="w-72 bg-gradient-to-b from-gray-900 via-gray-800 to-gray-900 text-white flex flex-col shadow-2xl">
            {/* Header */}
            <div className="p-6 border-b border-gray-700">
              <div className="flex items-center gap-4">
                <div className="w-14 h-14 bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg">
                  <span className="text-3xl">üçï</span>
                </div>
                <div>
                  <h1 className="font-extrabold text-xl tracking-tight">PIZZER√çA</h1>
                  <p className="text-gray-400 text-sm">Sistema POS</p>
                </div>
              </div>
            </div>

            {/* User Info */}
            <div className="p-6 border-b border-gray-700">
              <div className="flex items-center gap-3">
                <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-2xl ${
                  user.role === 'admin' 
                    ? 'bg-gradient-to-br from-purple-500 to-purple-700' 
                    : 'bg-gradient-to-br from-blue-500 to-blue-700'
                }`}>
                  {user.role === 'admin' ? 'üëë' : 'üíº'}
                </div>
                <div>
                  <p className="font-bold">{user.name}</p>
                  <p className={`text-xs uppercase tracking-wider ${
                    user.role === 'admin' ? 'text-purple-400' : 'text-blue-400'
                  }`}>
                    {user.role === 'admin' ? 'Administrador' : 'Cajero'}
                  </p>
                </div>
              </div>
            </div>

            {/* Navigation */}
            <nav className="flex-1 p-4">
              <ul className="space-y-2">
                {filteredMenu.map(item => (
                  <li key={item.id}>
                    <button
                      onClick={() => setView(item.id)}
                      className={`w-full flex items-center gap-4 px-5 py-4 rounded-xl transition-all ${
                        view === item.id
                          ? 'bg-gradient-to-r from-orange-500 to-red-600 text-white shadow-lg'
                          : 'text-gray-300 hover:bg-gray-700/50 hover:text-white'
                      }`}
                    >
                      <span className="text-2xl">{item.icon}</span>
                      <span className="font-semibold">{item.label}</span>
                    </button>
                  </li>
                ))}
              </ul>
            </nav>

            {/* Logout */}
            <div className="p-4 border-t border-gray-700">
              <button
                onClick={logout}
                className="w-full flex items-center justify-center gap-3 px-5 py-4 bg-gray-700/50 hover:bg-red-600 text-gray-300 hover:text-white rounded-xl transition-all"
              >
                <span className="text-xl">üö™</span>
                <span className="font-semibold">Cerrar Sesi√≥n</span>
              </button>
            </div>
          </aside>

          {/* Main Content */}
          <main className="flex-1 overflow-auto">
            {view === 'pos' && <POSView />}
            {view === 'sales' && <SalesReportView />}
            {view === 'products' && <ProductsView />}
            {view === 'history' && <HistoryView />}
          </main>
        </div>
      );
    }

    // ============================================
    // VISTA PUNTO DE VENTA (POS)
    // ============================================
    function POSView() {
      const { products, cart, addToCart, removeFromCart, updateQuantity, processSale } = useContext(AuthContext);
      const [paymentMethod, setPaymentMethod] = useState('efectivo');

      const activeProducts = products.filter(p => p.active);
      const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const total = subtotal;

      return (
        <div className="flex h-full">
          {/* Products Grid */}
          <div className="flex-1 p-6 overflow-auto">
            <div className="mb-6">
              <h2 className="text-3xl font-extrabold text-gray-800">Punto de Venta</h2>
              <p className="text-gray-500">Selecciona los productos para agregar al pedido</p>
            </div>

            <div className="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
              {activeProducts.map(product => (
                <button
                  key={product.id}
                  onClick={() => addToCart(product)}
                  className="group bg-white rounded-2xl p-6 shadow-lg hover:shadow-2xl transition-all transform hover:scale-[1.02] border-2 border-transparent hover:border-orange-400"
                >
                  <div className="text-6xl mb-4 group-hover:scale-110 transition-transform">
                    {product.image}
                  </div>
                  <h3 className="font-bold text-gray-800 text-lg mb-2">{product.name}</h3>
                  <p className="text-2xl font-extrabold text-orange-600">{formatCurrency(product.price)}</p>
                </button>
              ))}
            </div>
          </div>

          {/* Cart */}
          <div className="w-96 bg-white shadow-2xl flex flex-col border-l border-gray-100">
            <div className="p-6 bg-gradient-to-r from-orange-500 to-red-600 text-white">
              <h3 className="text-xl font-bold flex items-center gap-3">
                <span className="text-2xl">üõí</span>
                Pedido Actual
              </h3>
              <p className="text-orange-100 text-sm mt-1">{cart.length} productos</p>
            </div>

            {/* Cart Items */}
            <div className="flex-1 overflow-auto p-4">
              {cart.length === 0 ? (
                <div className="flex flex-col items-center justify-center h-full text-gray-400">
                  <span className="text-6xl mb-4">üõí</span>
                  <p className="font-medium">El carrito est√° vac√≠o</p>
                  <p className="text-sm">Agrega productos para comenzar</p>
                </div>
              ) : (
                <ul className="space-y-3">
                  {cart.map(item => (
                    <li key={item.id} className="bg-gray-50 rounded-xl p-4">
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-3">
                          <span className="text-2xl">{item.image}</span>
                          <span className="font-semibold text-gray-800">{item.name}</span>
                        </div>
                        <button
                          onClick={() => removeFromCart(item.id)}
                          className="text-red-500 hover:text-red-700 hover:bg-red-100 p-1 rounded-lg transition-colors"
                        >
                          ‚úï
                        </button>
                      </div>
                      <div className="flex justify-between items-center">
                        <div className="flex items-center gap-2 bg-white rounded-lg border border-gray-200">
                          <button
                            onClick={() => updateQuantity(item.id, item.quantity - 1)}
                            className="w-9 h-9 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-l-lg transition-colors font-bold"
                          >
                            ‚àí
                          </button>
                          <span className="w-10 text-center font-bold text-gray-800">{item.quantity}</span>
                          <button
                            onClick={() => updateQuantity(item.id, item.quantity + 1)}
                            className="w-9 h-9 flex items-center justify-center text-gray-600 hover:bg-gray-100 rounded-r-lg transition-colors font-bold"
                          >
                            +
                          </button>
                        </div>
                        <span className="font-bold text-orange-600 text-lg">
                          {formatCurrency(item.price * item.quantity)}
                        </span>
                      </div>
                    </li>
                  ))}
                </ul>
              )}
            </div>

            {/* Totals & Payment */}
            <div className="p-6 bg-gray-50 border-t border-gray-200">
              <div className="space-y-3 mb-6">
                <div className="flex justify-between text-gray-600">
                  <span>Subtotal</span>
                  <span className="font-medium">{formatCurrency(subtotal)}</span>
                </div>
                <div className="flex justify-between text-2xl font-extrabold text-gray-800 pt-3 border-t border-gray-200">
                  <span>TOTAL</span>
                  <span className="text-orange-600">{formatCurrency(total)}</span>
                </div>
              </div>

              {/* Payment Method */}
              <div className="mb-4">
                <label className="block text-sm font-bold text-gray-700 mb-2">M√©todo de Pago</label>
                <div className="grid grid-cols-3 gap-2">
                  {[
                    { id: 'efectivo', label: 'Efectivo', icon: 'üíµ' },
                    { id: 'tarjeta', label: 'Tarjeta', icon: 'üí≥' },
                    { id: 'transferencia', label: 'Transfer', icon: 'üì±' },
                  ].map(method => (
                    <button
                      key={method.id}
                      onClick={() => setPaymentMethod(method.id)}
                      className={`p-3 rounded-xl border-2 transition-all ${
                        paymentMethod === method.id
                          ? 'border-orange-500 bg-orange-50 text-orange-700'
                          : 'border-gray-200 hover:border-gray-300'
                      }`}
                    >
                      <span className="text-xl block mb-1">{method.icon}</span>
                      <span className="text-xs font-medium">{method.label}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Checkout Button */}
              <button
                onClick={() => processSale(paymentMethod)}
                disabled={cart.length === 0}
                className="w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold text-lg rounded-xl hover:from-green-600 hover:to-emerald-700 disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed transition-all shadow-lg"
              >
                {cart.length === 0 ? 'Agrega productos' : `Cobrar ${formatCurrency(total)}`}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // VISTA DE REPORTES DE VENTAS
    // ============================================
    function SalesReportView() {
      const { getSalesStats, sales } = useContext(AuthContext);
      const stats = getSalesStats();

      // Ventas por d√≠a del mes actual
      const getDailySales = () => {
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        const dailyData = {};
        sales.forEach(sale => {
          const d = new Date(sale.date);
          if (d.getMonth() === currentMonth && d.getFullYear() === currentYear) {
            const day = d.getDate();
            if (!dailyData[day]) {
              dailyData[day] = { count: 0, total: 0 };
            }
            dailyData[day].count++;
            dailyData[day].total += sale.total;
          }
        });
        return dailyData;
      };

      // Productos m√°s vendidos
      const getTopProducts = () => {
        const productCount = {};
        sales.forEach(sale => {
          sale.items.forEach(item => {
            if (!productCount[item.name]) {
              productCount[item.name] = { quantity: 0, revenue: 0 };
            }
            productCount[item.name].quantity += item.quantity;
            productCount[item.name].revenue += item.price * item.quantity;
          });
        });
        
        return Object.entries(productCount)
          .map(([name, data]) => ({ name, ...data }))
          .sort((a, b) => b.quantity - a.quantity)
          .slice(0, 5);
      };

      const dailySales = getDailySales();
      const topProducts = getTopProducts();
      const maxDaily = Math.max(...Object.values(dailySales).map(d => d.total), 1);

      return (
        <div className="p-8">
          <div className="mb-8">
            <h2 className="text-3xl font-extrabold text-gray-800">Reportes de Ventas</h2>
            <p className="text-gray-500">An√°lisis completo de ventas y rendimiento</p>
          </div>

          {/* Stats Cards */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl p-6 text-white shadow-xl">
              <div className="flex items-center justify-between mb-4">
                <span className="text-5xl">üìÖ</span>
                <span className="text-sm uppercase tracking-wider opacity-80">Hoy</span>
              </div>
              <p className="text-4xl font-extrabold mb-1">{formatCurrency(stats.today.total)}</p>
              <p className="text-blue-200">{stats.today.count} ventas</p>
            </div>

            <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-3xl p-6 text-white shadow-xl">
              <div className="flex items-center justify-between mb-4">
                <span className="text-5xl">üìÜ</span>
                <span className="text-sm uppercase tracking-wider opacity-80">Este Mes</span>
              </div>
              <p className="text-4xl font-extrabold mb-1">{formatCurrency(stats.month.total)}</p>
              <p className="text-purple-200">{stats.month.count} ventas</p>
            </div>

            <div className="bg-gradient-to-br from-orange-500 to-red-600 rounded-3xl p-6 text-white shadow-xl">
              <div className="flex items-center justify-between mb-4">
                <span className="text-5xl">üìä</span>
                <span className="text-sm uppercase tracking-wider opacity-80">Hist√≥rico</span>
              </div>
              <p className="text-4xl font-extrabold mb-1">{formatCurrency(stats.historical.total)}</p>
              <p className="text-orange-200">{stats.historical.count} ventas totales</p>
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Daily Sales Chart */}
            <div className="bg-white rounded-3xl p-6 shadow-xl">
              <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span className="text-2xl">üìà</span>
                Ventas Diarias del Mes
              </h3>
              <div className="space-y-3">
                {Object.entries(dailySales).length === 0 ? (
                  <p className="text-gray-500 text-center py-8">No hay ventas este mes</p>
                ) : (
                  Object.entries(dailySales).slice(-10).map(([day, data]) => (
                    <div key={day} className="flex items-center gap-4">
                      <span className="w-16 text-sm font-medium text-gray-600">D√≠a {day}</span>
                      <div className="flex-1 h-8 bg-gray-100 rounded-lg overflow-hidden">
                        <div 
                          className="h-full bg-gradient-to-r from-orange-400 to-red-500 rounded-lg transition-all duration-500"
                          style={{ width: `${(data.total / maxDaily) * 100}%` }}
                        />
                      </div>
                      <span className="w-28 text-right font-bold text-gray-800">{formatCurrency(data.total)}</span>
                    </div>
                  ))
                )}
              </div>
            </div>

            {/* Top Products */}
            <div className="bg-white rounded-3xl p-6 shadow-xl">
              <h3 className="text-xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <span className="text-2xl">üèÜ</span>
                Productos M√°s Vendidos
              </h3>
              {topProducts.length === 0 ? (
                <p className="text-gray-500 text-center py-8">No hay datos disponibles</p>
              ) : (
                <div className="space-y-4">
                  {topProducts.map((product, index) => (
                    <div key={product.name} className="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white ${
                        index === 0 ? 'bg-yellow-500' :
                        index === 1 ? 'bg-gray-400' :
                        index === 2 ? 'bg-amber-700' : 'bg-gray-300'
                      }`}>
                        {index + 1}
                      </div>
                      <div className="flex-1">
                        <p className="font-bold text-gray-800">{product.name}</p>
                        <p className="text-sm text-gray-500">{product.quantity} unidades vendidas</p>
                      </div>
                      <p className="font-bold text-orange-600">{formatCurrency(product.revenue)}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    // ============================================
    // VISTA DE PRODUCTOS
    // ============================================
    function ProductsView() {
      const { products, addProduct, updateProduct, deleteProduct } = useContext(AuthContext);
      const [showModal, setShowModal] = useState(false);
      const [editingProduct, setEditingProduct] = useState(null);
      const [formData, setFormData] = useState({ name: '', price: '', category: 'pizza', image: 'üçï' });

      const emojis = ['üçï', 'üßÄ', 'üçç', 'ü•ì', 'üå∂Ô∏è', 'üçÑ', 'ü´í', 'ü•¨', 'üçó', 'ü•§', 'üç∫', 'üßÉ'];

      const openModal = (product = null) => {
        if (product) {
          setEditingProduct(product);
          setFormData({ name: product.name, price: product.price.toString(), category: product.category, image: product.image });
        } else {
          setEditingProduct(null);
          setFormData({ name: '', price: '', category: 'pizza', image: 'üçï' });
        }
        setShowModal(true);
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        const productData = {
          name: formData.name,
          price: parseFloat(formData.price),
          category: formData.category,
          image: formData.image
        };

        if (editingProduct) {
          updateProduct(editingProduct.id, productData);
        } else {
          addProduct(productData);
        }
        setShowModal(false);
      };

      return (
        <div className="p-8">
          <div className="flex justify-between items-center mb-8">
            <div>
              <h2 className="text-3xl font-extrabold text-gray-800">Gesti√≥n de Productos</h2>
              <p className="text-gray-500">Administra el cat√°logo de productos</p>
            </div>
            <button
              onClick={() => openModal()}
              className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold rounded-xl hover:from-orange-600 hover:to-red-700 transition-all shadow-lg"
            >
              <span className="text-xl">+</span>
              Nuevo Producto
            </button>
          </div>

          {/* Products Table */}
          <div className="bg-white rounded-3xl shadow-xl overflow-hidden">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="text-left p-6 font-bold text-gray-700">Producto</th>
                  <th className="text-left p-6 font-bold text-gray-700">Categor√≠a</th>
                  <th className="text-left p-6 font-bold text-gray-700">Precio</th>
                  <th className="text-left p-6 font-bold text-gray-700">Estado</th>
                  <th className="text-right p-6 font-bold text-gray-700">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {products.map(product => (
                  <tr key={product.id} className="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                    <td className="p-6">
                      <div className="flex items-center gap-4">
                        <span className="text-4xl">{product.image}</span>
                        <span className="font-bold text-gray-800">{product.name}</span>
                      </div>
                    </td>
                    <td className="p-6">
                      <span className="px-4 py-2 bg-gray-100 rounded-lg text-gray-600 capitalize">
                        {product.category}
                      </span>
                    </td>
                    <td className="p-6">
                      <span className="font-bold text-orange-600 text-lg">{formatCurrency(product.price)}</span>
                    </td>
                    <td className="p-6">
                      <button
                        onClick={() => updateProduct(product.id, { active: !product.active })}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          product.active 
                            ? 'bg-green-100 text-green-700 hover:bg-green-200' 
                            : 'bg-red-100 text-red-700 hover:bg-red-200'
                        }`}
                      >
                        {product.active ? '‚úì Activo' : '‚úï Inactivo'}
                      </button>
                    </td>
                    <td className="p-6">
                      <div className="flex justify-end gap-2">
                        <button
                          onClick={() => openModal(product)}
                          className="p-3 bg-blue-100 text-blue-600 rounded-xl hover:bg-blue-200 transition-colors"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button
                          onClick={() => deleteProduct(product.id)}
                          className="p-3 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors"
                        >
                          üóëÔ∏è
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {/* Modal */}
          {showModal && (
            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-3xl p-8 w-full max-w-md shadow-2xl">
                <h3 className="text-2xl font-extrabold text-gray-800 mb-6">
                  {editingProduct ? 'Editar Producto' : 'Nuevo Producto'}
                </h3>
                <form onSubmit={handleSubmit} className="space-y-6">
                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Icono</label>
                    <div className="flex flex-wrap gap-2">
                      {emojis.map(emoji => (
                        <button
                          key={emoji}
                          type="button"
                          onClick={() => setFormData({ ...formData, image: emoji })}
                          className={`w-12 h-12 rounded-xl text-2xl flex items-center justify-center transition-all ${
                            formData.image === emoji 
                              ? 'bg-orange-500 scale-110 shadow-lg' 
                              : 'bg-gray-100 hover:bg-gray-200'
                          }`}
                        >
                          {emoji}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Nombre</label>
                    <input
                      type="text"
                      value={formData.name}
                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none"
                      placeholder="Ej: Pizza Especial"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Precio (MXN)</label>
                    <input
                      type="number"
                      value={formData.price}
                      onChange={(e) => setFormData({ ...formData, price: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none"
                      placeholder="99"
                      min="0"
                      step="0.01"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-bold text-gray-700 mb-2">Categor√≠a</label>
                    <select
                      value={formData.category}
                      onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none"
                    >
                      <option value="pizza">Pizza</option>
                      <option value="bebida">Bebida</option>
                      <option value="complemento">Complemento</option>
                      <option value="postre">Postre</option>
                    </select>
                  </div>

                  <div className="flex gap-3 pt-4">
                    <button
                      type="button"
                      onClick={() => setShowModal(false)}
                      className="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-colors"
                    >
                      Cancelar
                    </button>
                    <button
                      type="submit"
                      className="flex-1 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white font-bold rounded-xl hover:from-orange-600 hover:to-red-700 transition-all"
                    >
                      {editingProduct ? 'Guardar' : 'Crear'}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ============================================
    // VISTA DE HISTORIAL
    // ============================================
    function HistoryView() {
      const { sales, printReceipt } = useContext(AuthContext);
      const [filter, setFilter] = useState('all');

      const filteredSales = sales.filter(sale => {
        if (filter === 'all') return true;
        const saleDate = new Date(sale.date);
        const now = new Date();
        if (filter === 'today') return saleDate.toDateString() === now.toDateString();
        if (filter === 'week') {
          const weekAgo = new Date(now.setDate(now.getDate() - 7));
          return saleDate >= weekAgo;
        }
        return true;
      }).reverse();

      return (
        <div className="p-8">
          <div className="flex justify-between items-center mb-8">
            <div>
              <h2 className="text-3xl font-extrabold text-gray-800">Historial de Ventas</h2>
              <p className="text-gray-500">Registro completo de todas las transacciones</p>
            </div>
            <div className="flex gap-2">
              {[
                { id: 'all', label: 'Todo' },
                { id: 'today', label: 'Hoy' },
                { id: 'week', label: 'Semana' },
              ].map(f => (
                <button
                  key={f.id}
                  onClick={() => setFilter(f.id)}
                  className={`px-5 py-2 rounded-xl font-medium transition-all ${
                    filter === f.id
                      ? 'bg-orange-500 text-white'
                      : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                  }`}
                >
                  {f.label}
                </button>
              ))}
            </div>
          </div>

          {filteredSales.length === 0 ? (
            <div className="bg-white rounded-3xl p-12 text-center shadow-xl">
              <span className="text-6xl mb-4 block">üìã</span>
              <p className="text-xl font-bold text-gray-800">No hay ventas registradas</p>
              <p className="text-gray-500">Las ventas aparecer√°n aqu√≠ cuando se procesen</p>
            </div>
          ) : (
            <div className="space-y-4">
              {filteredSales.map(sale => (
                <div key={sale.id} className="bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <p className="font-bold text-gray-800 text-lg">Venta #{sale.id}</p>
                      <p className="text-gray-500 text-sm">{formatDate(sale.date)}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-2xl font-extrabold text-orange-600">{formatCurrency(sale.total)}</p>
                      <span className={`inline-block px-3 py-1 rounded-lg text-sm font-medium ${
                        sale.paymentMethod === 'efectivo' ? 'bg-green-100 text-green-700' :
                        sale.paymentMethod === 'tarjeta' ? 'bg-blue-100 text-blue-700' :
                        'bg-purple-100 text-purple-700'
                      }`}>
                        {sale.paymentMethod === 'efectivo' ? 'üíµ' : sale.paymentMethod === 'tarjeta' ? 'üí≥' : 'üì±'} {sale.paymentMethod}
                      </span>
                    </div>
                  </div>
                  
                  <div className="flex flex-wrap gap-2 mb-4">
                    {sale.items.map((item, i) => (
                      <span key={i} className="px-3 py-1 bg-gray-100 rounded-lg text-sm">
                        {item.image} {item.name} x{item.quantity}
                      </span>
                    ))}
                  </div>

                  <div className="flex justify-between items-center pt-4 border-t border-gray-100">
                    <p className="text-sm text-gray-500">Atendido por: <span className="font-medium">{sale.cashier}</span></p>
                    <button
                      onClick={() => printReceipt(sale)}
                      className="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-xl transition-colors text-gray-700 font-medium"
                    >
                      üñ®Ô∏è Reimprimir
                    </button>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Renderizar la aplicaci√≥n
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PizzeriaApp />);
  </script>
</body>
</html>
